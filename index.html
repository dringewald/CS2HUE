<!DOCTYPE html>
<html>

<head>
  <title>CS2 Hue Controller</title>
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="icon" type="image/png" href="/img/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/img/favicon/favicon.svg" />
  <link rel="shortcut icon" href="/img/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="CS2Hue" />
  <link rel="manifest" href="/img/favicon/site.webmanifest" />
</head>

<body>
  <h1>💣 CS2 Hue Bomb Control</h1>

  <div id="globalSpinner" class="spinner-overlay">
    <div class="spinner"></div>
    <div id="spinnerStatusText" class="spinner-status-text"></div>
  </div>

  <div id="lightSelectionModal" class="modal">
    <div class="modal-content">
      <h2 id="modalTitle"></h2>
      <p id="modalCallout"></p>

      <!-- 🔴 Modal Warning -->
      <p id="modalWarning" style="display: none; color: #ff4d4d; font-weight: bold; margin-top: 0;"></p>

      <!-- Tabs -->
      <div class="tab-container">
        <button class="tab-btn active" data-tab="grouped">Grouped</button>
        <button class="tab-btn" data-tab="all">All</button>
      </div>

      <!-- Tab content panes -->
      <div class="tab-content">
        <div id="groupedTab" class="tab-pane active">
          <ul id="groupedLightsList" class="light-list lightCheckboxList"></ul>
        </div>
        <div id="allTab" class="tab-pane">
          <ul id="allLightsList" class="light-list"></ul>
        </div>
      </div>

      <!-- Footer buttons -->
      <div class="modal-footer">
        <button id="confirmLightSelection">✅ OK</button>
        <button id="cancelLightSelection">❌ Cancel</button>
      </div>
    </div>
  </div>

  <div class="section">
    <label>Provider:</label>
    <select id="provider" title="Choose which lighting system to use">
      <option value="hue">Hue</option>
      <option value="yeelight">Yeelight</option>
    </select>
    <button class="oldborder" id="autoDetectBridge">🔍 Auto Detect Hue Bridge</button>
    <label>Bridge IP:</label>
    <div class="toggle-secret">
      <input type="text" id="bridgeIP" class="secret-input" placeholder="The IP of your Hue Bridge"
        title="The IP address of your Philips Hue Bridge. Find it via the Hue app, https://discovery.meethue.com/ or your router.">
      <button class="reveal-btn" type="button">
        <img src="img/eye-password-hide.svg" alt="toggle visibility" />
      </button>
    </div>

    <label>API Key:</label>
    <div class="toggle-secret">
      <input type="text" id="apiKey" class="secret-input" placeholder="Your Hue API Key"
        title="Your authorized Hue API key. Needed to control the lights.">
      <button class="reveal-btn" type="button">
        <img src="img/eye-password-hide.svg" alt="toggle visibility" />
      </button>
    </div>

    <div id="yeelightBlock" style="display:none; margin-top:8px">
      <label>Yeelight Discovery:</label>
      <select id="yeelightDiscovery">
        <option value="false">Disabled</option>
        <option value="true">Enabled</option>
      </select>

      <label>Yeelight Devices (host[:port], comma-separated):</label>
      <input type="text" id="yeelightDevices" placeholder="192.168.0.21:55443, 192.168.0.22" />
    </div>

    <label>Server IP:</label>
    <div class="toggle-secret">
      <input type="text" id="serverHost" class="secret-input" placeholder="The IP of the Server"
        title="Host address where the local server listens for game data. Leave as 127.0.0.1 unless you know what you're doing. Make sure you also update the ip in the gamestate_integration_cs2hue.cfg file inside your CS2 config folder if you change this value.">
      <button class="reveal-btn" type="button">
        <img src="img/eye-password-hide.svg" alt="toggle visibility" />
      </button>
    </div>

    <label>Server Port:</label>
    <div class="toggle-secret">
      <input type="number" id="serverPort" class="secret-input" placeholder="The Port of the Server"
        title="Port for the server. If 8080 is taken, change this to another available port. Make sure you also update the port in the gamestate_integration_cs2hue.cfg file inside your CS2 config folder if you change this value.">
      <button class="reveal-btn" type="button">
        <img src="img/eye-password-hide.svg" alt="toggle visibility" />
      </button>
    </div>

    <div class="form-row with-light-selector">
      <label for="lightIds">Light IDs (comma separated):</label>
      <div class="light-id-wrapper">
        <input type="text" id="lightIds" class="secret-input visible" placeholder="e.g. 1,2,3"
          title="Comma-separated list of Hue light IDs you want to control. Get IDs via the Hue API or developer tools." />
        <button id="reselectLightsBtn" class="reselect-button" title="Reopen light selector to update Light IDs">
          🔁 Select Lights
        </button>
      </div>
    </div>

    <label>Show Bomb Timer:</label>
    <select id="showTimer" title="Enables extra logs showing the bomb countdown (only if a bomb is planted).">
      <option value="true">Enabled</option>
      <option value="false">Disabled</option>
    </select>

    <div class="row">
      <label for="discordRpcToggle" title="Discord Rich Presence anzeigen">Discord RPC</label>
      <select id="discordRpcToggle" title="Enable or disable Discord Rich Presence integration.">
        <option value="true">Enabled</option>
        <option value="false">Disabled</option>
      </select>
    </div>

    <label>HTML Logfile:</label>
    <select id="htmlLog"
      title="If true, saves the full session log into an HTML file under /logs/. Useful for debugging.">
      <option value="true">Enabled</option>
      <option value="false">Disabled</option>
    </select>

    <label>Debug Mode:</label>
    <select id="debugMode" title="Enables extra [DEBUG] logs in the console for troubleshooting.">
      <option value="true">Enabled</option>
      <option value="false">Disabled</option>
    </select>

    <label>Live Log (max lines):</label>
    <input type="number" id="liveLogNumber" class="secret-input visible" placeholder="1000"
      title="Max number of log lines to keep in memory for the HTML live view. Adjust higher for long sessions if needed. Higher = More RAM">

    <button class="oldborder" id="saveConfig">💾 Save Config</button>
    <button class="oldborder" id="openConfig">📁 Open Config Folder</button>
  </div>

  <div class="section">
    <h3>🎨 Edit Colors</h3>
    <div id="colorsDisplay"></div>
    <button class="oldborder" id="saveColors">💾 Save Colors</button>
  </div>

  <div id="bombSettingsWrapper" class="section">
    <h3>💣 Bomb Settings</h3>
    <div id="bombStagesGrid"></div>
    <button class="oldborder" id="saveBombSettings">💾 Save Bomb Stages</button>
  </div>

  <!-- Discord Presence Config -->
  <div class="section" id="discordPresenceSection"
    style="margin-top:12px; border-top:1px solid #333; padding-top:12px;">
    <h3>🎮 Discord Presence</h3>

    <div class="row">
      <label for="discordShowElapsed" title="Show Discord's elapsed timer (startTimestamp)">Show Elapsed Timer</label>
      <select id="discordShowElapsed">
        <option value="true">Enabled</option>
        <option value="false">Disabled</option>
      </select>
    </div>

    <div class="row">
      <label for="discordUseParty" title="Use the 'party size' line to show Round X/Y">Round Line via Party Size</label>
      <select id="discordUseParty">
        <option value="true">Enabled</option>
        <option value="false">Disabled</option>
      </select>
    </div>

    <div class="row">
      <label for="discordResetOnRound" title="Restart elapsed timer each round start">Reset Timer on Round Start</label>
      <select id="discordResetOnRound">
        <option value="false">No</option>
        <option value="true">Yes</option>
      </select>
    </div>

    <div class="row">
      <label for="discordUpdateRate" title="How often we re-assert presence (seconds)">Presence Update Rate (s)</label>
      <input type="number" id="discordUpdateRate" class="secret-input visible" min="5" max="60" placeholder="15" />
    </div>

    <h4 style="margin-top:10px">📣 Which events update Discord?</h4>

    <!-- Use the same toggle UI pattern as color "enabled" switches -->
    <div class="events-toggle-list" id="discordDisplay">
      <!-- In Menu -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">In Menu</span>
            <label class="toggle-switch">
              <!-- Keep the same ID for JS compatibility -->
              <input type="checkbox" id="rpcEvt_menu" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>

      <!-- Round Start -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">Round Start</span>
            <label class="toggle-switch">
              <input type="checkbox" id="rpcEvt_roundStart" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>

      <!-- Bomb Planted -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">Bomb Planted</span>
            <label class="toggle-switch">
              <input type="checkbox" id="rpcEvt_bombPlanted" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>

      <!-- Bomb Defused -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">Bomb Defused</span>
            <label class="toggle-switch">
              <input type="checkbox" id="rpcEvt_bombDefused" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>

      <!-- Bomb Exploded -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">Bomb Exploded</span>
            <label class="toggle-switch">
              <input type="checkbox" id="rpcEvt_bombExploded" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>

      <!-- Round Won -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">Round Won</span>
            <label class="toggle-switch">
              <input type="checkbox" id="rpcEvt_roundWon" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>

      <!-- Round Lost -->
      <div class="enabled-wrapper">
        <div class="toggle-container">
          <span class="toggle-wrapper">
            <span class="toggle-text">Round Lost</span>
            <label class="toggle-switch">
              <input type="checkbox" id="rpcEvt_roundLost" checked>
              <span class="toggle-slider"></span>
            </label>
          </span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="section" id="controlButtons">
    <button id="startScript">▶️ Start Script</button>
    <button id="stopScript">⏹ Stop Script</button>
    <button id="reloadConfig">⚙️ Reload Config</button>
    <button id="restartScript">🔁 Restart Script</button>
  </div>

  <div class="section">
    <div class="log-header">
      <h3 class="log-title">📄 Log</h3>
      <div class="log-actions">
        <button id="openDocBtn" class="log-btn" type="button" style="display: none;">🌐 Open Doc</button>
        <button id="openLogBtn" class="log-btn" type="button" style="display: none;">🌐 Open Log</button>
      </div>
    </div>
    <pre id="log"></pre>
  </div>

  <script src="renderer.js"></script>
</body>

</html>